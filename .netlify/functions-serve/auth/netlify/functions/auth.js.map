{
  "version": 3,
  "sources": ["../../../../OneDrive/Desktop/Landing/netlify/functions/auth.js"],
  "sourceRoot": "C:/Users/pcc/AppData/Local/Temp/tmp-50136-NLXDThg7LIe5",
  "sourcesContent": ["const crypto = require('crypto');\n\n// Credentials from environment variables (set in Netlify dashboard)\nconst VALID_USER = process.env.AUTH_USERNAME;\nconst VALID_PASSWORD = process.env.AUTH_PASSWORD;\nconst JWT_SECRET = process.env.JWT_SECRET || crypto.randomBytes(32).toString('hex');\n\n// Generate a secure token\nfunction generateToken(username) {\n    const payload = {\n        user: username,\n        exp: Date.now() + (30 * 60 * 1000), // 30 minutes\n        iat: Date.now()\n    };\n    const data = JSON.stringify(payload);\n    const signature = crypto\n        .createHmac('sha256', JWT_SECRET)\n        .update(data)\n        .digest('hex');\n    return Buffer.from(JSON.stringify({ data, signature })).toString('base64');\n}\n\n// Verify token\nfunction verifyToken(token) {\n    try {\n        const decoded = JSON.parse(Buffer.from(token, 'base64').toString());\n        const expectedSignature = crypto\n            .createHmac('sha256', JWT_SECRET)\n            .update(decoded.data)\n            .digest('hex');\n        \n        if (expectedSignature !== decoded.signature) {\n            return { valid: false, error: 'Invalid signature' };\n        }\n        \n        const payload = JSON.parse(decoded.data);\n        if (Date.now() > payload.exp) {\n            return { valid: false, error: 'Token expired' };\n        }\n        \n        return { valid: true, user: payload.user };\n    } catch {\n        return { valid: false, error: 'Invalid token' };\n    }\n}\n\n// Constant-time string comparison to prevent timing attacks\nfunction secureCompare(a, b) {\n    if (!a || !b) return false;\n    if (a.length !== b.length) return false;\n    return crypto.timingSafeEqual(Buffer.from(a), Buffer.from(b));\n}\n\nexports.handler = async (event) => {\n    // CORS headers\n    const headers = {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n        'Access-Control-Allow-Methods': 'POST, OPTIONS',\n        'Content-Type': 'application/json'\n    };\n\n    // Handle preflight\n    if (event.httpMethod === 'OPTIONS') {\n        return { statusCode: 204, headers };\n    }\n\n    if (event.httpMethod !== 'POST') {\n        return {\n            statusCode: 405,\n            headers,\n            body: JSON.stringify({ error: 'Method not allowed' })\n        };\n    }\n\n    try {\n        const body = JSON.parse(event.body || '{}');\n        const { action, username, password, token } = body;\n\n        // Login action\n        if (action === 'login') {\n            // Validate credentials exist in environment\n            if (!VALID_USER || !VALID_PASSWORD) {\n                console.error('AUTH_USERNAME or AUTH_PASSWORD not configured');\n                return {\n                    statusCode: 500,\n                    headers,\n                    body: JSON.stringify({ error: 'Server configuration error' })\n                };\n            }\n\n            // Add delay to prevent brute force (100-300ms random)\n            await new Promise(r => setTimeout(r, 100 + Math.random() * 200));\n\n            // Secure comparison\n            const userMatch = secureCompare(username, VALID_USER);\n            const passMatch = secureCompare(password, VALID_PASSWORD);\n\n            if (userMatch && passMatch) {\n                const token = generateToken(username);\n                return {\n                    statusCode: 200,\n                    headers,\n                    body: JSON.stringify({ success: true, token })\n                };\n            }\n\n            return {\n                statusCode: 401,\n                headers,\n                body: JSON.stringify({ success: false, error: 'Invalid credentials' })\n            };\n        }\n\n        // Verify token action\n        if (action === 'verify') {\n            const result = verifyToken(token);\n            return {\n                statusCode: result.valid ? 200 : 401,\n                headers,\n                body: JSON.stringify(result)\n            };\n        }\n\n        return {\n            statusCode: 400,\n            headers,\n            body: JSON.stringify({ error: 'Invalid action' })\n        };\n\n    } catch (error) {\n        console.error('Auth error:', error);\n        return {\n            statusCode: 500,\n            headers,\n            body: JSON.stringify({ error: 'Internal server error' })\n        };\n    }\n};\n"],
  "mappings": "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",
  "names": ["token"]
}
